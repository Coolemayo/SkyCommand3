<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkyCommand Dashboard</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
<style>
body { 
  background: url('https://source.unsplash.com/1920x1080/?airplane,sky') no-repeat center/cover; 
  color:#fff; font-family:sans-serif; 
}
nav, main { background: rgba(0,0,0,0.7); padding:20px; border-radius:12px; margin:10px; }
button { background:#001f54; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:bold;}
button:hover { background:#003080; }
input, textarea { background: rgba(255,255,255,0.1); color:white; border:none; padding:8px; border-radius:5px; width:100%; margin:5px 0;}
section { margin-bottom:30px; }
table { width:100%; background: rgba(255,255,255,0.1); border-radius:8px;}
thead { background: rgba(0,0,0,0.4); }
</style>
</head>
<body>
<nav>
<h1>SkyCommand Dashboard</h1>
<a href="/logout">Logout</a>
</nav>
<main>
<section>
<h2>Flight Logging</h2>
<form id="logForm" enctype="multipart/form-data">
<input name="callsign" placeholder="Callsign" required>
<input name="aircraft" placeholder="Aircraft" required>
<input name="departure" placeholder="Departure ICAO" required>
<input name="arrival" placeholder="Arrival ICAO" required>
<input name="altitude" placeholder="Altitude" required>
<textarea name="remarks" placeholder="Remarks"></textarea>
<input type="file" name="screenshot" accept="image/*" required>
<button type="submit">Submit</button>
</form>
<p id="status"></p>
</section>

<section>
<h2>Stats</h2>
<p>Fl√ºge: <span id="flightsCount">0</span></p>
<p>Flugstunden: <span id="hoursCount">0</span></p>
</section>

<section>
<h2>Recent Flights</h2>
<table>
<thead><tr><th>Callsign</th><th>From</th><th>To</th><th>Altitude</th></tr></thead>
<tbody id="flightsList"></tbody>
</table>
</section>
</main>

<script>
document.getElementById("logForm").addEventListener("submit", async e => {
  e.preventDefault();
  const form = e.target;
  const data = new FormData(form);
  document.getElementById("status").textContent = "Submitting...";
  const res = await fetch("/api/log", { method:"POST", body:data });
  const json = await res.json();
  document.getElementById("status").textContent = json.success ? "Flight logged!" : "Error logging flight";
  loadStats();
  loadFlights();
});

async function loadStats(){
  try {
    const stats = await fetch("/api/stats").then(r=>r.json());
    document.getElementById("flightsCount").textContent = stats.flights || 0;
    document.getElementById("hoursCount").textContent = stats.hours || 0;
  } catch { console.log("Failed to load stats"); }
}

async function loadFlights(){
  try {
    const flights = await fetch("/api/flights").then(r=>r.json());
    const tbody = document.getElementById('flightsList');
    tbody.innerHTML = flights.map(f=>`<tr>
      <td>${f.callsign}</td>
      <td>${f.departure}</td>
      <td>${f.arrival}</td>
      <td>${f.altitude}</td>
    </tr>`).join("");
  } catch { console.log("Failed to load flights"); }
}

loadStats();
loadFlights();
</script>
</body>
</html>